# Results


## How Moviegoing in the U.S. Has Shifted Since the Pandemic
### Chart 1. U.S. Theatrical Box Office Revenue by Year
```{r}
# --- Load Box Office Data ---
library(tidyverse)
box_office <- read_csv("data/box_office.csv", show_col_types = FALSE)
library(ggplot2)
library(scales)

ggplot(box_office, aes(x = Year, y = Domestic_BoxOffice)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_y_continuous(
    limits = c(0, NA),
    breaks = seq(0, 12e9, by = 2e9),
    labels = label_dollar(scale = 1e-9, suffix = "B", accuracy = 1)
  ) +
  scale_x_continuous(
    breaks = pretty(box_office$Year, n = 10),
    minor_breaks = NULL
  ) +
  labs(
    title = "U.S. Theatrical Box Office Revenue by Year",
    subtitle = "Pre-COVID peak, COVID collapse, and incomplete recovery",
    x = "Year",
    y = "Domestic Box Office (USD, billions)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )
```
Box office revenues have climbed steadily from the 2020 low. However, rather than returning to their earlier levels, the total box office revenues appear to be settling into a lower range than before the pandemic.


### Chart 2. Number of Theatrical Releases per Year
```{r}
ggplot(box_office, aes(Year, Releases)) +
  geom_col(fill = "#4C72B0") +
  labs(
    title = "Number of Theatrical Releases per Year",
    subtitle = "Industry output remains lower than pre-COVID",
    x = "Year",
    y = "Number of Releases"
  ) +
  scale_x_continuous(
    breaks = pretty(box_office$Year, n = 10),
    minor_breaks = NULL
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background  = element_rect(fill = "white", color = NA),
    panel.grid.minor = element_blank()
  )

```
The number of theatrical releases dropped sharply in 2020 and remained below pre-pandemic levels. This indicates that studios have reduced their annual output, releasing fewer films than before—likely reflecting shifts in production and distribution strategies.


### Chart 3. Change in AMC Theatres by State (2019–2024)
```{r}
library(readxl)
library(dplyr)
library(stringr)
library(sf)
library(ggplot2)
library(scales)

## 1. Read AMC tables -------------------------------------------------------

amc_2019 <- read_excel(
  "data/AMC_theatres_screens_by_market_2019.xlsx",
  sheet = 1
) |>
  rename(
    state    = `U.S. Markets`,
    theatres = Theatres,
    screens  = Screens
  ) |>
  mutate(state = str_trim(state))

amc_2024 <- read_excel(
  "data/AMC_theatres_screens_by_market_2024.xlsx",
  sheet = 1
) |>
  rename(
    state    = `U.S. Markets`,
    theatres = Theatres,
    screens  = Screens
  ) |>
  mutate(state = str_trim(state))

## 2. Read shapefile + keep only contiguous U.S. ---------------------------

states_sf <- st_read("data/cb_2018_us_state_20m/cb_2018_us_state_20m.shp")

states_sf_conus <- states_sf |>
  filter(!STUSPS %in% c("AK", "HI", "PR", "GU", "VI", "AS", "MP")) |>
  mutate(state = NAME)

# vector of valid state names (lower 48 + DC)
valid_states <- states_sf_conus$state

## 3. Filter AMC tables to states in shapefile -----------------------------

amc_2019_clean <- amc_2019 |>
  filter(state %in% valid_states)

amc_2024_clean <- amc_2024 |>
  filter(state %in% valid_states)

## 4. Compute changes ------------------------------------------------------

state_changes <- amc_2019_clean |>
  select(
    state,
    theatres_2019 = theatres,
    screens_2019  = screens
  ) |>
  inner_join(
    amc_2024_clean |>
      select(
        state,
        theatres_2024 = theatres,
        screens_2024  = screens
      ),
    by = "state"
  ) |>
  mutate(
    theatres_change     = theatres_2024 - theatres_2019,
    theatres_pct_change = (theatres_2024 - theatres_2019) / theatres_2019,
    screens_change      = screens_2024 - screens_2019,
    screens_pct_change  = (screens_2024 - screens_2019) / screens_2019
  )

## 5. Join back to shapefile for mapping -----------------------------------

map_data <- states_sf_conus |>
  left_join(state_changes, by = "state")
```

```{r}
library(ggplot2)
library(scales)

ggplot(map_data) +
  geom_sf(aes(fill = theatres_pct_change),
          color = "white", size = 0.2) +
  # zoom to lower 48 + DC
  coord_sf(xlim = c(-125, -66), ylim = c(24, 50), expand = FALSE) +
  scale_fill_gradient2(
    name   = "Percent change\nin theatres",
    labels = percent_format(accuracy = 1),
    low    = "#b2182b",   # more negative (closures)
    mid    = "white",
    high   = "#2166ac",   # more positive (growth)
    midpoint = 0
  ) +
  labs(
    title    = "Change in AMC Theatres by State (2019–2024)",
    subtitle = "Percent change in number of theatres",
    caption  = "Source: AMC U.S. Markets Theatres & Screens tables, 2019 vs 2024"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title = element_blank()
  )
```


## 2. While most U.S. sectors recovered strongly post-COVID, the movie industry lags behind
### Chart 4. Movie Industry vs Major Sector ETFs (Rebased to 1)
```{r}
### --- Load & clean Media data ---
media <- read_csv("data/movie_media_clean.csv", show_col_types = FALSE) |>
  mutate(Date = as.Date(Date))

# --- Load & clean Sector ETFs ---
sectors <- read_csv("data/sector_etfs_clean.csv", show_col_types = FALSE) |>
  mutate(Date = as.Date(Date))


# Rebase each media company to 1
media_rebased <- media |>
  group_by(Ticker) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(base = first(Adj_Close),
         rebased = Adj_Close / base) |>
  ungroup()

# Compute equal-weight average index
movie_index <- media_rebased |>
  group_by(Date) |>
  summarize(
    Movie_Index = mean(rebased, na.rm = TRUE)
  )

sectors_rebased <- sectors |>
  group_by(Ticker, Sector) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    base = first(`Adj Close`),
    rebased = `Adj Close` / base
  ) |>
  ungroup()

# Sector ETF index
sector_index <- sectors_rebased |>
  select(Date, Sector, rebased)

# Movie Index needs a pseudo "Sector" label
movie_index2 <- movie_index |>
  mutate(Sector = "Movie Industry")

combined <- bind_rows(
  sector_index,
  movie_index2 |> mutate(rebased = Movie_Index)
)
```

```{r}
library(dplyr)
library(ggplot2)
library(scales)

combined2 <- combined  # same data as before

ggplot() +
  # 1. All other sectors: normal colors, thinner, slightly transparent
  geom_line(
    data = combined2 |> filter(Sector != "Movie Industry"),
    aes(x = Date, y = rebased, colour = Sector),
    linewidth = 0.6,
    alpha = 0.6
  ) +
  # 2. Movie industry: bold red, thicker
  geom_line(
    data = combined2 |> filter(Sector == "Movie Industry"),
    aes(x = Date, y = rebased, colour = Sector),
    linewidth = 1.6
  ) +
  scale_color_manual(
    values = c(
      "Consumer Staples" = "#bc80bd",
      "Energy"           = "#ff7f00",
      "Financials"       = "#1f78b4",
      "Health Care"      = "#33a02c",
      "Industrials"      = "#6a3d9a",
      "Movie Industry"   = "#d73027",   # bold red highlight
      "S&P 500"          = "black",
      "Technology"       = "#ffd92f"
    ),
    name = "Sector / Industry"
  ) +
  scale_y_log10(
    breaks = c(0.5, 1, 2, 3, 5),
    labels = c("0.5x", "1x", "2x", "3x", "5x")
  ) +
  scale_x_date(
    date_breaks = "1 year",
    date_labels = "%Y"
  ) +
  labs(
    title = "Movie Industry vs Major Sector ETFs (Rebased to 1)",
    subtitle = "Movie industry index highlighted against major sector ETFs (log scale)",
    x = "Date",
    y = "Rebased price (log scale)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background  = element_rect(fill = "white", color = NA),
    panel.grid.minor = element_blank(),
    legend.position = "right"
  )

```
The movie industry index is an equal-weighted average of rebased stock prices of companies in our movie_media_clean.csv dataset. From 2019- 2025, the Technology industry showed the strongest overall gains, while the energy industry displayed the greatest volatility. The movie industry performed relatively well through late 2020 to 2022. Post-2022, the movie industry lagged behind most sectors, indicating a slower and less consistent recovery than the market as a whole.

### Chart 5. Stock Price Performance of Movie Companies From 2019–2025
```{r}
library(dplyr)

media_rebased <- media |>
  group_by(Ticker) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    base    = first(Adj_Close),
    rebased = Adj_Close / base,
    ret     = log(rebased / dplyr::lag(rebased))  # daily log return
  ) |>
  ungroup()

vol_df <- media_rebased |>
  group_by(Ticker) |>
  summarize(
    vol = sd(ret, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(vol))

# Choose top 3 most volatile tickers
highlight_tickers <- vol_df$Ticker[1:3]
highlight_tickers

```
```{r}
library(ggplot2)
library(scales)
library(dplyr)

# 1. Which tickers do we want to highlight?
highlight_tickers    <- highlight_tickers          # your top 3 volatile
highlight_all        <- c(highlight_tickers, "^GSPC")

# Optional: nicer label for S&P
media_rebased <- media_rebased |>
  mutate(Ticker_label = if_else(Ticker == "^GSPC", "S&P 500", Ticker))

ggplot() +
  # --- Background: all other tickers in grey ---
  geom_line(
    data = media_rebased |> filter(!Ticker %in% highlight_all),
    aes(x = Date, y = rebased, group = Ticker),
    color = "grey80",
    linewidth = 0.5,
    alpha = 0.7
  ) +
  # --- Highlight: top 3 most volatile tickers ---
  geom_line(
    data = media_rebased |> filter(Ticker %in% highlight_tickers),
    aes(x = Date, y = rebased, color = Ticker_label),
    linewidth = 1.4
  ) +
  # --- Highlight: S&P 500 (black line) ---
  geom_line(
    data = media_rebased |> filter(Ticker == "^GSPC"),
    aes(x = Date, y = rebased, color = Ticker_label),
    linewidth = 1.4
  ) +
  # manual colors: black for S&P, Dark2 for the 3 volatile names
  scale_color_manual(
    name   = "Highlighted tickers",
    values = c(
      "S&P 500" = "black",
      RColorBrewer::brewer.pal(length(highlight_tickers), "Dark2") |>
        setNames(highlight_tickers)
    )
  ) +
  scale_y_log10(
    breaks = c(0.1, 0.2, 0.5, 1, 2, 5, 10),
    labels = c("0.1x", "0.2x", "0.5x", "1x", "2x", "5x", "10x")
  ) +
  scale_x_date(
    date_breaks = "1 year",
    date_labels = "%Y"
  ) +
  labs(
    title = "Stock Price Performance of Movie Companies From 2019–2025",
    subtitle = "Top 3 most volatile tickers and the S&P 500 highlighted; prices rebased to 1 at first date",
    x = "Date",
    y = "Rebased price (log scale)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background  = element_rect(fill = "white", color = NA),
    panel.grid.minor = element_blank()
  )


```

This chart shows that two companies drove much of the volatility in the movie industry, helping explain the sector’s brief strength from late 2020 to 2022 (see chart 4). For example, Roku’s share price rose sharply in 2020, corresponding to higher streaming usage during stay-at-home conditions. AMC experienced large price swings in early 2021. This was due to the “meme-stock” trading frenzy driven by movements from the reddit group wallstreetbets. These movements stood out from the rest of the movie industry. However, in 2022, both ROKU and AMC collapsed— revealing these were temporary movements rather than sustained industry/company strength. 

### Chart 6. Sector Cumulative Performance Since 2019
```{r}

library(dplyr)
library(ggplot2)
library(forcats)
library(scales)

# 1) Get final rebased level for each Sector
final_perf <- combined |>
  arrange(Sector, Date) |>
  group_by(Sector) |>
  filter(!is.na(rebased)) |>
  slice_tail(n = 1) |>
  ungroup() |>
  transmute(
    Sector,
    multiple = rebased   # how many times the 2019 starting value
  ) |>
  mutate(
    Sector = fct_reorder(Sector, multiple),
    is_movie = (Sector == "Movie Industry"),
    label = paste0("×", round(multiple, 1))
  )

ggplot(final_perf, aes(x = Sector, y = multiple, fill = is_movie)) +
  geom_col() +
  geom_text(
    aes(label = label),
    hjust = -0.1,
    size = 3
  ) +
  coord_flip(clip = "off") +
  scale_fill_manual(
    values = c("FALSE" = "grey70", "TRUE" = "#d73027"),
    guide = "none"
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    title = "Sector Cumulative Performance Since 2019",
    subtitle = "Each bar shows final rebased level (2019 = 1)",
    x = "",
    y = "Rebased level (× starting value)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.margin = margin(5.5, 40, 5.5, 5.5)
  )
```
This bar chart compares how much each major U.S. sector and the movie industry have grown since 2019 (in “× starting value” terms), highlighting that the movie industry’s cumulative performance has lagged behind most other sectors.


## 3. Performance of sub-industries within the movie industry differ
### Chart 7. Faceted Sub-Industry in Movie Industry Performance
```{r}
library(dplyr)
library(ggplot2)
library(scales)

# 1. Rebase each ticker
media_rebased <- media |>
  filter(!is.na(Adj_Close)) |>
  group_by(Ticker, SubIndustry) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    base    = first(Adj_Close),
    rebased = Adj_Close / base
  ) |>
  ungroup()

# 2. Equal-weighted average within each sub-industry by date
sub_avg <- media_rebased |>
  group_by(SubIndustry, Date) |>
  summarize(
    rebased_avg = mean(rebased, na.rm = TRUE),
    .groups = "drop"
  )

# 3. Compute volatility of each sub-industry (based on log returns)
sub_vol <- sub_avg |>
  group_by(SubIndustry) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(ret = log(rebased_avg / lag(rebased_avg))) |>
  summarize(
    vol = sd(ret, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(vol))

# 4. Order facets from most to least volatile
sub_avg <- sub_avg |>
  mutate(SubIndustry = factor(SubIndustry, levels = sub_vol$SubIndustry))

# 5. Plot: one average line per sub-industry, faceted
ggplot(sub_avg, aes(Date, rebased_avg)) +
  geom_line(color = "#2c7fb8", linewidth = 1) +
  facet_wrap(~ SubIndustry, ncol = 2) +
  scale_y_log10(
    breaks = c(0.25, 0.5, 1, 2, 4, 8),
    labels = c("0.25x", "0.5x", "1x", "2x", "4x", "8x")
  ) +
  scale_x_date( 
    date_breaks = "1 year", date_labels = "%Y" 
  ) +
  labs(
    title = "Faceted Sub-Industry in Movie Industry Performance",
    subtitle = "Equal-weighted average of rebased stock prices, ordered by volatility (log scale)",
    y = "Average rebased price (log scale)",
    x = "Date"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.background = element_rect(fill = "white", color = NA),
    plot.background  = element_rect(fill = "white", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    strip.text = element_text(size = 14, face = "bold"),
    panel.spacing = grid::unit(1.2, "lines"),
    plot.title.position = "plot",
    axis.text.x = element_text(size = 9)
  )


```
Theater companies and streamer companies exhibit the most volatility. Theater companies experienced a steep drop in stock price in 2020 followed by an uneven recovery. Streamers rise sharply through 2020–2021 before dropping significantly in 2022. Diversified media firms trend more steadily upward, while studios show a mild, gradual decline.

### Chart 8. Correlation Between Movie Sub-Industries (2015–2025)
```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(tibble)

# --- Rebase, build subindustry index, make wide matrix ---
media_rebased <- media |>
  filter(!is.na(Adj_Close)) |>
  group_by(Ticker) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    base    = first(Adj_Close),
    rebased = Adj_Close / base
  ) |>
  ungroup()

subindustry_index <- media_rebased |>
  group_by(Date, SubIndustry) |>
  summarize(SubIndex = mean(rebased, na.rm = TRUE), .groups = "drop")

order_vec <- c("Benchmark", "Streamer", "Diversified", "Studio", "Theater")

sub_wide <- subindustry_index |>
  pivot_wider(names_from = SubIndustry, values_from = SubIndex) |>
  select(all_of(order_vec))

cor_mat <- cor(sub_wide, use = "pairwise.complete.obs")

cor_long <- cor_mat |>
  as.data.frame() |>
  rownames_to_column("Var1") |>
  pivot_longer(cols = all_of(order_vec),
               names_to = "Var2",
               values_to = "Correlation") |>
  mutate(
    Var1 = factor(Var1, levels = order_vec),
    Var2 = factor(Var2, levels = order_vec)
  )

# --- Plot heatmap with better color scale ---
ggplot(cor_long, aes(Var1, Var2, fill = Correlation)) +
  geom_tile(color = "white", linewidth = 0.4) +
  geom_text(aes(label = round(Correlation, 2)), size = 3) +
  scale_fill_gradient2(
    low  = "#2166ac",   # blue for negative correlations
    mid  = "white",     # zero
    high = "#b2182b",   # red for positive correlations
    midpoint = 0,
    limits = c(min(cor_long$Correlation), 1),
    name = "Correlation"
  ) +
  coord_fixed() +
  labs(
    title = "Correlation Between Movie Sub-Industries (2015–2025)",
    subtitle = "Diverging color scale centered at zero highlights negative vs. positive relationships",
    x = NULL, y = NULL
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank(),
    plot.title.position = "plot"
  )


```
Diversified companies and the overall market are the most closely aligned (0.84). Studios and theaters show moderate alignment (0.66). Streamers and studios also track each other fairly well (0.74). Theaters stand out as the outlier — their stock movements line up much less with the rest of the industry. This suggests that theater chains react to a different set of forces than streaming or diversified media firms.

### Chart 9. Density of Daily Returns by Sub-Industry (2019- 2025)
```{r}
library(dplyr)
library(ggridges)
library(scales)

# 1. Subindustry daily returns
sub_daily <- media |>
  filter(!is.na(return)) |>
  group_by(Date, SubIndustry) |>
  summarize(sub_ret = mean(return, na.rm = TRUE), .groups = "drop")

# 2. Order subindustries by volatility (optional but nice)
sub_order <- sub_daily |>
  group_by(SubIndustry) |>
  summarize(sd_ret = sd(sub_ret, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(sd_ret)) |>
  pull(SubIndustry)

sub_daily <- sub_daily |>
  mutate(SubIndustry = factor(SubIndustry, levels = sub_order))

# 3. Ridgeline plot with less overlap
ggplot(sub_daily, aes(x = sub_ret, y = SubIndustry, fill = SubIndustry)) +
  geom_density_ridges(alpha = 0.8, scale = 1.2) +  # smaller scale = less stacking
  scale_x_continuous(
    labels = percent,
    limits = c(-0.08, 0.08)
  ) +
  labs(
    title = "Density of Daily Returns by Sub-Industry (2019- 2025)",
    subtitle = "Zoomed in on typical daily moves (±8%)",
    x = "Daily return",
    y = NULL
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "none",
    panel.background = element_rect(fill = "white", color = NA)
  )

```
Benchmark and diversified firms have the lowest day-to-day volatility. Studios are in the middle. Streamers have larger tails, reflecting bigger daily moves during the period. Theater stocks are the most volatile, with the widest distribution and most frequent large positive and negative returns.

### Chart 10. How Movie/Media Stocks Move Across Performance Buckets Over Time
```{r}
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(lubridate)
library(forcats)

# 1) Add regime labels -----------------------------------------------------
media_regime <- media |>
  mutate(
    Date = as.Date(Date),
    regime = case_when(
      Date < as.Date("2020-02-20") ~ "Pre-COVID",
      Date >= as.Date("2020-02-20") & Date <= as.Date("2021-12-31") ~ "COVID & stimulus",
      Date >= as.Date("2022-01-01") & Date <= as.Date("2022-12-31") ~ "Rate hikes / inflation",
      Date >= as.Date("2023-01-01") ~ "AI / recent",
      TRUE ~ NA_character_
    )
  ) |>
  filter(!is.na(regime), !is.na(return))

# 2) CUMULATIVE return per Ticker × SubIndustry × Regime ------------------
regime_perf <- media_regime |>
  group_by(Ticker, SubIndustry, regime) |>
  summarize(
    cum_ret = prod(1 + return, na.rm = TRUE) - 1,  # (1+r1)*(1+r2)*... - 1
    .groups = "drop"
  )

# 3) Bucket each ticker into Low / Mid / High within each regime ----------
regime_buckets <- regime_perf |>
  group_by(regime) |>
  mutate(
    q1 = quantile(cum_ret, 0.33, na.rm = TRUE),
    q2 = quantile(cum_ret, 0.67, na.rm = TRUE),
    bucket = case_when(
      cum_ret <= q1 ~ "Low",
      cum_ret >= q2 ~ "High",
      TRUE          ~ "Mid"
    )
  ) |>
  ungroup() |>
  mutate(
    bucket = factor(bucket, levels = c("Low", "Mid", "High"))
  )

# 4) Order regimes for the x-axis -----------------------------------------
regime_levels <- c("Pre-COVID", "COVID & stimulus",
                   "Rate hikes / inflation", "AI / recent")

flow_df <- regime_buckets |>
  filter(regime %in% regime_levels) |>
  mutate(
    regime = factor(regime, levels = regime_levels)
  )

# 5) Alluvial plot: ticker flows between buckets across regimes -----------
ggplot(
  flow_df,
  aes(x = regime,
      stratum = bucket,
      alluvium = Ticker,
      y = 1,
      fill = SubIndustry)
) +
  geom_flow(stat = "alluvium",
            lode.guidance = "forward",
            color = "grey50",
            alpha = 0.6) +
  geom_stratum(color = "black") +
  geom_text(
    stat = "stratum",
    aes(label = after_stat(stratum)),
    size = 3,
    color = "black"
  ) +
  scale_y_continuous(expand = c(0, 0)) +
  labs(
    title = "How Movie/Media Stocks Move Across Performance Buckets Over Time",
    subtitle = "Each stream is a ticker; Low / Mid / High based on cumulative return in each regime",
    x = "Regime",
    y = "Number of tickers",
    fill = "Subindustry"
  ) +
  theme_minimal()
```




```{r}
library(dplyr)
library(ggplot2)
library(scales)

regime_order <- c("Pre-COVID",
                  "COVID & stimulus",
                  "Rate hikes / inflation",
                  "AI / recent")

regime_sub <- media_regime |>
  group_by(SubIndustry, regime) |>
  summarize(
    cum_ret = prod(1 + return, na.rm = TRUE) - 1,
    .groups = "drop"
  ) |>
  mutate(
    regime = factor(regime, levels = regime_order)
  )

ggplot(regime_sub,
       aes(x = regime, y = cum_ret, fill = SubIndustry)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = percent) +
  labs(
    title = "Cumulative Return by Subindustry and Regime",
    subtitle = "COVID & stimulus period supercharged streamers; theaters lag in later regimes",
    x = "",
    y = "Cumulative return in regime"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```


```{r}
# 1) Movie industry equal-weight price index (use Adj_Close, not rebased)
movie_index <- media |>
  filter(SubIndustry != "Benchmark") |>
  group_by(Date) |>
  summarize(
    movie_price = mean(Adj_Close, na.rm = TRUE),
    .groups = "drop"
  )

# 2) S&P 500
sp <- media |>
  filter(Ticker == "^GSPC") |>
  select(Date, sp_price = Adj_Close)

# 3) Netflix
nflx <- media |>
  filter(Ticker == "NFLX") |>
  select(Date, nflx_price = Adj_Close)

# 4) Align dates and rebase all three to 1 at common start
all3 <- movie_index |>
  inner_join(sp, by = "Date") |>
  inner_join(nflx, by = "Date") |>
  arrange(Date)

base_movie <- first(all3$movie_price)
base_sp    <- first(all3$sp_price)
base_nflx  <- first(all3$nflx_price)

relative_long <- all3 |>
  mutate(
    `Movie Industry` = movie_price / base_movie,
    `S&P 500`        = sp_price    / base_sp,
    `Netflix`        = nflx_price  / base_nflx
  ) |>
  select(Date, `Movie Industry`, `S&P 500`, `Netflix`) |>
  pivot_longer(
    cols = -Date,
    names_to = "Series",
    values_to = "rebased"
  )

ggplot(relative_long, aes(Date, rebased, color = Series)) +
  geom_line(linewidth = 1) +
  scale_y_log10() +
  labs(
    title = "Netflix vs Movie Industry vs S&P 500 (Rebased)",
    subtitle = "Netflix tracks the broad market more closely than the struggling movie industry",
    x = "Date",
    y = "Rebased Price (log scale)",
    color = ""
  ) +
  theme_minimal()
```

```{r}
library(dplyr)
library(ggplot2)

focus_tickers <- c("NFLX", "ROKU", "AMC", "DIS", "^GSPC")

media_focus <- media |>
  filter(Ticker %in% focus_tickers, !is.na(Adj_Close)) |>
  group_by(Ticker) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    base    = first(Adj_Close),
    rebased = Adj_Close / base
  ) |>
  ungroup()

ggplot(media_focus,
       aes(x = Date, y = rebased, color = Ticker)) +
  geom_line(linewidth = 0.9, alpha = 0.9) +
  scale_y_log10() +
  labs(
    title = "Rebased Performance of Selected Movie/Media Stocks",
    subtitle = "Each ticker rebased to 1 at its first non-missing price (log scale)",
    x = "Date",
    y = "Rebased price (log scale)"
  ) +
  theme_minimal()
```

```{r}
library(dplyr)
library(ggplot2)
library(scales)

# compute metrics for the same tickers
stock_stats <- media |>
  filter(Ticker %in% focus_tickers, !is.na(return)) |>
  group_by(Ticker) |>
  arrange(Date, .by_group = TRUE) |>
  mutate(
    rebased   = cumprod(1 + return),          # grows from 1
    roll_max  = cummax(rebased),
    drawdown  = rebased / roll_max - 1
  ) |>
  summarize(
    cum_ret      = last(rebased) - 1,
    ann_ret      = (1 + mean(return, na.rm = TRUE))^252 - 1,
    ann_vol      = sd(return, na.rm = TRUE) * sqrt(252),
    max_drawdown = min(drawdown, na.rm = TRUE),
    .groups = "drop"
  )

stock_stats
```

```{r}
ggplot(stock_stats,
       aes(x = Ticker, y = max_drawdown)) +
  geom_col() +
  scale_y_continuous(labels = percent) +
  labs(
    title = "Max Drawdown for Selected Stocks",
    x = "",
    y = "Max drawdown from prior peak"
  ) +
  theme_minimal()
```


```{r}
library(dplyr)
library(ggplot2)
library(scales)

regime_order <- c("Pre-COVID",
                  "COVID & stimulus",
                  "Rate hikes / inflation",
                  "AI / recent")

regime_focus <- media_regime |>
  filter(Ticker %in% focus_tickers,
         !is.na(return),
         !is.na(regime)) |>
  group_by(Ticker, regime) |>
  summarize(
    cum_ret = prod(1 + return, na.rm = TRUE) - 1,
    .groups = "drop"
  ) |>
  mutate(
    regime = factor(regime, levels = regime_order)
  )

ggplot(regime_focus,
       aes(x = regime, y = cum_ret, fill = Ticker)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = percent) +
  labs(
    title = "Cumulative Return by Regime for Selected Stocks",
    x = "",
    y = "Cumulative return in regime"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```
